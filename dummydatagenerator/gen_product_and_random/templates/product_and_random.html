{% extends "base.html" %} {% block content %}
{% load static %}
<!-- {% load widget_tweaks %} -->

<div class="container">
    <div class="row">
        <div class="col" >
            <form method="post" id="json_upload_form" enctype="multipart/form-data">
                {% csrf_token %}
                <label for="id_photo" class="filelabel"></label>
                <div class="is-danger">{{ form.document | add_class:'form-control' }}</div>
            </form>
        </div>
        <div class="col d-flex align-items-end">
            <button form="json_upload_form" class="button is-danger" type="submit" name = "submit">アップロードする</button>
        </div>
    </div>
</div>

{% if file %} {% if not error_msg %}
    <div class="mt-5 alert alert-secondary" role="alert">
        アップロードに成功しました： {{ file }}
    </div>
{% endif %} {% endif %}

{% if error_msg %}
    <div class="mt-2 alert alert-primary" role="alert">
        <div class="row">
            <div class="col ">
                {{ error_msg.JSON_error | linebreaks }}
                {{ error_msg.error_msg | linebreaks }}
                {{ error_msg.error_form | linebreaks }}
                {{ error_msg.error_rule | linebreaks }}
                {{ error_msg.error_templete | linebreaks }}
            </div>
            <div class="col">
                {{ error_msg.error_sample | linebreaks }}
            </div>
        </div>
    </div>
{% endif%}

<div class="tile">
    <div class="tile">
        {% if text %} {% if not error_msg %}
        <form action = "" method="post" id="gen_form" >
            {% csrf_token %}
            <div class = "field">
                <div class = "control">
                    <button class="mt-5 button is-danger" name = "generate">Generate!</button> 
                </div>
            </div>
        </form>
        {% endif %} {% endif %}
    </div>
    <div class="tile">
        {% if dataframe %}
            <form action = "" method="post" id="download_csv" >
                {% csrf_token %}
                <div class = "field">
                    <div class = "control">
                        <button class="mt-5 button is-danger" name = "download_csv"> Download CSV</button> 
                    </div>
                </div>
            </form>
        {% endif %}
    </div>
</div>

<div class="col">
    <table class="table-secondary" style="width:100px; height:100px;">
        {% if dataframe %}
            {{ dataframe | safe }}
        {% endif %}
    </table>
</div>

<!-- <div class="mt-2 container">
    <div class="row">
        <div class="col">
            {% regroup text by column_name as cname_list %}
            <ul>
                {% for cname in cname_list %}
                    <li> 項目名：{{ cname.grouper }}
                    <ul>   
                        {% for p in cname.list %}
                            {% if p.generate_type %}
                            <li> 生成タイプ：{{ p.generate_type }}</li>
                            {% endif %}
                            {% if p.linked_cname %}
                            <li> リンク項目：{{ p.linked_cname }}</li>
                            {% endif %}
                            <li> 生成データ：{{ p.generate_data }} </li>    
                        {% endfor %}
                    </ul>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div class="col">
            <table class="table-secondary" style="width:100px; height:100px;">
                {% if dataframe %}
                    {{ dataframe | safe }}
                {% endif %}
            </table>
        </div>
    </div>
</div> -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" 
    crossorigin="anonymous">
</script>

{% endblock %}